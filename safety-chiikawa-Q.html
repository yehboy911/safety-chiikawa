<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂÖíÁ´•ÁâàÔºöÂè∞ÁÅ£ÂÖ®Ê∞ëÂÆâÂÖ®ÊåáÂºïÂ≠∏ÁøíÊ©ü</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --chiikawa-pink: #ffb8d1;
            --chiikawa-blue: #89cff0;
            --chiikawa-yellow: #fff59d;
            --chiikawa-brown: #5d4037;
            --chiikawa-green: #77dd77;
            --chiikawa-red: #ff6961;
        }

        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            color: var(--chiikawa-brown);
            background-color: #fff;
            /* Polka Dot Background */
            background-image: radial-gradient(var(--chiikawa-pink) 20%, transparent 20%),
                              radial-gradient(var(--chiikawa-blue) 20%, transparent 20%);
            background-size: 40px 40px;
            background-position: 0 0, 20px 20px;
            /* Prevent bounce on mobile */
            overscroll-behavior: none;
            touch-action: manipulation;
        }

        .chiikawa-card {
            background: rgba(255, 255, 255, 0.95);
            border: 4px solid var(--chiikawa-pink);
            border-radius: 30px;
            box-shadow: 8px 8px 0px var(--chiikawa-blue);
        }

        .btn-base {
            transition: all 0.1s;
            border-radius: 20px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
        }
        
        .btn-base:active {
            transform: translateY(4px);
            box-shadow: none;
        }

        .keypad-btn {
            background-color: var(--chiikawa-blue);
            color: white;
            font-size: 1.5rem;
            border-radius: 25px;
            height: 60px;
        }

        .action-btn {
            background-color: var(--chiikawa-yellow);
            color: var(--chiikawa-brown);
        }

        /* Mode Switcher Tabs */
        .tab-active {
            background-color: var(--chiikawa-pink);
            color: white;
            border: 3px solid var(--chiikawa-pink);
        }
        .tab-inactive {
            background-color: white;
            color: var(--chiikawa-brown);
            border: 3px solid var(--chiikawa-pink);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden flex justify-center items-center">

    <div id="root" class="w-full h-full max-w-md mx-auto relative"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Data: Âè∞ÁÅ£ÂÖ®Ê∞ëÂÆâÂÖ®ÊåáÂºï (ÂÆåÊï¥Áâà) ---
        const DATA = {
            "01Âπ≥ÊôÇÁöÑÊ∫ñÂÇô": [
                { 
                    id: 101, type: "number", q: "Êó•Â∏∏ÁöÑÂ±ÖÂÆ∂ÂÑ≤ÂÇôÔºåÂª∫Ë≠∞ÊúÄÂ∞ëË¶ÅÊ∫ñÂÇô„ÄåÂπæÈÄ±„ÄçÁöÑ‰ªΩÈáèÔºü", a: "1", unit: "ÈÄ±", 
                    context: "„ÄêÊó•Â∏∏Â±ÖÂÆ∂ÂÑ≤ÂÇôÊ∏ÖÂñÆ„Äë\nÂª∫Ë≠∞Ê∫ñÂÇôËá≥Â∞ë 1 ÈÄ±‰ªΩÈáèÔºö\n‚óèÈ£üÂìÅÔºöÊØè‰∫∫ÊØèÊó•3ÂÖ¨ÂçáÊ∞¥„ÄÅÊ≥°È∫µ„ÄÅÁΩêÈ†≠„ÄÅÂ†ÖÊûú„ÄÅË™øÂë≥Êñô„ÄÇ\n‚óèÁîüÊ¥ªÔºöÂ°ëËÜ†Ë¢ã„ÄÅ‰øùÈÆÆËÜú„ÄÅÈõªÊ±†„ÄÅÊâãÂ•ó„ÄÅËÜ†Â∏∂„ÄÇ\n‚óèË°õÁîüÔºöÊÄ•ÊïëÁÆ±„ÄÅÂè£ÁΩ©„ÄÅÈÖíÁ≤æ„ÄÅÂ∏∏ÂÇôËó•„ÄÅË°õÁîüÊ£â„ÄÇ\n‚óèÂÖ∂‰ªñÔºöÂ¨∞ÂÖíÂ•∂Á≤âÂ∞øÂ∏É„ÄÅÈï∑Ëº©Âä©ËÅΩÂô®ÈõªÊ±†„ÄÅÂØµÁâ©È£ºÊñôËàáÁâΩÁπ©„ÄÇ" 
                },
                { 
                    id: 102, type: "number", q: "È£üÂìÅÂÑ≤ÂÇô‰∏≠ÔºåÂª∫Ë≠∞„ÄåÊØè‰∫∫ÊØèÊó•„ÄçËá≥Â∞ëÊ∫ñÂÇôÂπæÂÖ¨ÂçáÁöÑÈ£≤Áî®Ê∞¥Ôºü", a: "3", unit: "ÂÖ¨Âçá", 
                    context: "Ê∞¥ÊòØÊúÄÈáçË¶ÅÁöÑÔºÅÊØèÂÄã‰∫∫ÊØèÂ§©Ëá≥Â∞ëÈúÄË¶Å 3 ÂÖ¨ÂçáÁöÑÈ£≤Áî®Ê∞¥„ÄÇÈô§‰∫ÜÊ∞¥Ôºå‰πüË¶ÅÊ∫ñÂÇôÁ±≥„ÄÅÁΩêÈ†≠„ÄÅË™øÁêÜÂåÖ„ÄÅÈ§Ö‰πæ„ÄÅÂ∑ßÂÖãÂäõÁ≠âÂÆπÊòì‰øùÂ≠òÁöÑÈ£üÁâ©ÂñîÔºÅ" 
                },
                { 
                    id: 103, type: "number", q: "Á∑äÊÄ•ÈÅøÈõ£ÂåÖÂÖßÁöÑÁâ©ÂìÅÔºåËá≥Â∞ëÊØè„ÄåÂπæÂπ¥„ÄçË¶ÅÊ™¢Êü•‰∏ÄÊ¨°ÊòØÂê¶ÈÅéÊúüÊàñÊêçÂ£ûÔºü", a: "0.5", displayA: "ÂçäÂπ¥", inputHint: "(Ëº∏ÂÖ•0.5)", 
                    context: "„ÄêÁ∑äÊÄ•ÈÅøÈõ£ÂåÖÊ™¢Êü•„Äë\nË®òÂæóÊØè„ÄåÂçäÂπ¥ (0.5Âπ¥)„ÄçÂ∞±Ë¶ÅÊ™¢Êü•‰∏ÄÊ¨°ÔºÅ\nÁ¢∫Ë™çÈ£üÁâ©Ê∞¥Ê≤íÈÅéÊúü„ÄÅÈõªÊ±†ÊúâÈõª„ÄÅËó•ÂìÅÂú®ÊúüÈôêÂÖß„ÄÇ\nÂª∫Ë≠∞ÊîæÂú®„ÄåÂ§ßÈñÄÂè£„ÄçÊàñ„ÄåÁéÑÈóú„ÄçÈö®ÊâãÂèØÊãøÁöÑÂú∞Êñπ„ÄÇ" 
                },
                { 
                    id: 104, type: "number", q: "‰∏ÄËà¨Âª∫Ë≠∞„ÄåÁî∑ÊÄß„ÄçÁöÑÁ∑äÊÄ•ÈÅøÈõ£ÂåÖÔºåÈáçÈáè‰∏çÂÆúË∂ÖÈÅéÂπæÂÖ¨Êñ§Ôºü", a: "15", unit: "ÂÖ¨Êñ§", 
                    context: "„ÄêÈÅøÈõ£ÂåÖÈáçÈáèÂª∫Ë≠∞„Äë\nËÉåÂ§™ÈáçÊúÉË∑ë‰∏çÂãïÂñîÔºÅ\n‚óèÁî∑ÊÄßÂª∫Ë≠∞Ôºö15 ÂÖ¨Êñ§‰ª•ÂÖß\n‚óèÂ•≥ÊÄßÂª∫Ë≠∞Ôºö10 ÂÖ¨Êñ§‰ª•ÂÖß\nË´ãÈÅ∏ÊìáË≥™Ëºï„ÄÅËÄêÁî®ÁöÑÈõôËÇ©ËÉåÂåÖ„ÄÇ" 
                },
                { 
                    id: 105, type: "number", q: "‰∏ÄËà¨Âª∫Ë≠∞„ÄåÂ•≥ÊÄß„ÄçÁöÑÁ∑äÊÄ•ÈÅøÈõ£ÂåÖÔºåÈáçÈáè‰∏çÂÆúË∂ÖÈÅéÂπæÂÖ¨Êñ§Ôºü", a: "10", unit: "ÂÖ¨Êñ§", 
                    context: "„ÄêÈÅøÈõ£ÂåÖÈáçÈáèÂª∫Ë≠∞„Äë\n‚óèÂ•≥ÊÄßÂª∫Ë≠∞Ôºö10 ÂÖ¨Êñ§‰ª•ÂÖß\nÂÖßÂÆπÁâ©ÂåÖÂê´ÔºöÈ£≤Áî®Ê∞¥„ÄÅ‰πæÁ≥ß„ÄÅË≠â‰ª∂ÂΩ±Êú¨„ÄÅÁèæÈáëÈõ∂Èå¢„ÄÅÊØõÂ∑æ„ÄÅ‰øùÊöñË°£Áâ©„ÄÅË°åÂãïÈõªÊ∫ê„ÄÅÂì®Â≠ê„ÄÅÊâãÈõªÁ≠í„ÄÇ" 
                }
            ],
            "02Áï∂Âç±Ê©ü‰æÜËá®ÊôÇ": [
                { 
                    id: 201, type: "number", q: "Èò≤Á©∫Ë≠¶Â†±ÁöÑ„ÄåÈï∑Èü≥„ÄçÊòØÊåÅÁ∫åÂπæÁßíÈêòÔºü", a: "15", unit: "Áßí", 
                    context: "„ÄêÈò≤Á©∫Ë≠¶Â†±Ë≠òÂà•„Äë\n‚óèÈï∑Èü≥Ôºö15Áßí\n‚óèÁü≠Èü≥Ôºö5Áßí\n‚óèÈñìÈöîÔºö5Áßí\nÈÄôÂÄãÂæ™Áí∞ÊúÉÈáçË§á3Ê¨°ÔºåÁ∏ΩÂÖ±115Áßí„ÄÇËÅΩÂà∞ÈÄôÂÄãËÅ≤Èü≥Ë¶ÅÁ´ãÂàªÈÖçÂêàÈÅøÈõ£ÔºÅ" 
                },
                { 
                    id: 202, type: "number", q: "Èò≤Á©∫Ë≠¶Â†±Ëß£Èô§ÊôÇÔºåÊúÉÈüø‰∏ÄËÅ≤Èï∑Èü≥ÔºåÈï∑ÈÅîÂπæÁßíÔºü", a: "90", unit: "Áßí", 
                    context: "Áï∂‰Ω†ËÅΩÂà∞‰∏ÄËÅ≤Èï∑Èï∑ÁöÑ„ÄÅÈÄ£Á∫å 90 ÁßíÁöÑËÅ≤Èü≥ÔºåÂ∞±‰ª£Ë°®„ÄåË≠¶Â†±Ëß£Èô§„Äç‰∫ÜÔºåÂèØ‰ª•ÊÅ¢Âæ©Ê≠£Â∏∏Ê¥ªÂãïÔºå‰ΩÜÈÇÑÊòØË¶ÅÈö®ÊôÇÊ≥®ÊÑèÊñ∞ËÅû„ÄÇ" 
                },
                { 
                    id: 203, type: "number", q: "Êµ∑ÂòØË≠¶Â†±ÁöÑ„ÄåÈ≥¥ËÅ≤„ÄçÊòØÂπæÁßíÈêòÔºü", a: "5", unit: "Áßí", 
                    context: "„ÄêÊµ∑ÂòØË≠¶Â†±„Äë\nËÅ≤Èü≥Ê®°ÂºèÔºöÈ≥¥ 5 Áßí„ÄÅÂÅú 5 Áßí„ÄÅÈ≥¥ 5 Áßí„ÄÇ\nÈÄöÂ∏∏ÊúÉ‰º¥Èö®Ë™ûÈü≥Âª£Êí≠Ôºö„ÄåÊµ∑ÂòØË≠¶Â†±ÔºåË´ãËøÖÈÄüÂæÄÈ´òËôïÁñèÊï£„Äç„ÄÇ" 
                },
                { 
                    id: 204, type: "number", q: "ÈÅ≠ÈÅáÊµ∑ÂòØÊôÇÔºåÂª∫Ë≠∞ÂæÄÂÖßÈô∏È´òËôïÈÅøÈõ£ÔºåÈ´òÂ∫¶Ëá≥Â∞ëÁ¥ÑÂπæÂ±§Ê®ì‰ª•‰∏äÔºü", a: "3", unit: "Â±§Ê®ì", 
                    context: "„ÄêÊµ∑ÂòØÈÅøÈõ£ÂéüÂâá„Äë\n1. ÂæÄÂÖßÈô∏Ë∑ëÔºàÈÅ†Èõ¢Êµ∑Â≤∏Ôºâ„ÄÇ\n2. ÂæÄÈ´òËôïË∑ëÔºàÂûÇÁõ¥ÈÅøÈõ£Ôºâ„ÄÇ\nÂª∫Ë≠∞Ëá≥Â∞ëË∑ëÂà∞ 3 Â±§Ê®ì‰ª•‰∏äÁöÑÈ´òÂ∫¶ÊâçÂÆâÂÖ®„ÄÇ" 
                },
                { 
                    id: 205, type: "number", q: "Êìç‰ΩúCPRÊÄ•ÊïëÊôÇÔºåËÉ∏ÈÉ®ÊåâÂ£ìÊ∑±Â∫¶Ëá≥Â∞ëË¶ÅÂπæÂÖ¨ÂàÜÔºü", a: "5", unit: "ÂÖ¨ÂàÜ", 
                    context: "„ÄêCPR Âè£Ë®£ÔºöÂè´Âè´Â£ìÈõª„Äë\nÊåâÂ£ìÊ∑±Â∫¶Ë¶ÅÂ§†Ê∑±ÔºàËá≥Â∞ë5ÂÖ¨ÂàÜÔºâÔºåÈÄüÂ∫¶Ë¶ÅÂ§†Âø´ÔºàÊØèÂàÜÈêò100-120‰∏ãÔºâÔºåÊâçËÉΩÊúâÊïàÂπ´Âä©ÂøÉËáüËº∏Ë°Ä„ÄÇ" 
                },
                { 
                    id: 206, type: "number", q: "‰ΩøÁî®Ê≠¢Ë°ÄÂ∏∂Ê≠¢Ë°ÄÊôÇÔºåÊáâÁ∂ÅÂú®Âá∫Ë°ÄÈªû‰∏äÊñπÁ¥ÑÂπæÂÖ¨ÂàÜËôïÔºü", a: "5", unit: "ÂÖ¨ÂàÜ", 
                    context: "„ÄêÂö¥ÈáçÂá∫Ë°ÄÊÄ•Êïë„Äë\nÂ¶ÇÊûúÊúâÊ≠¢Ë°ÄÂ∏∂ÔºåÁ∂ÅÂú®ÂÇ∑Âè£‰∏äÊñπ 5-8 ÂÖ¨ÂàÜËôï„ÄÇ‰∏¶Ë®ò‰∏ã„ÄåÈñãÂßã‰ΩøÁî®ÁöÑÊôÇÈñì„ÄçÔºå‰∫§Áµ¶ÈÜ´Ë≠∑‰∫∫Âì°„ÄÇ" 
                }
            ],
            "03Êî∂Á©´ÂÆ∂Âúí": [
                { 
                    id: 301, type: "number", q: "ÁÇ∫‰∫ÜËæ®Âà•ÂÅáË®äÊÅØÔºåÊàëÂÄëË¶ÅÂ†ÖÊåÅ„ÄåÂπæ‰∏ç‰∏ÄË¶Å„ÄçÂéüÂâáÔºü", a: "3", unit: "‰∏ç", 
                    context: "„ÄêÂÅáË®äÊÅØÈò≤Á¶¶Ôºö3‰∏ç1Ë¶Å„Äë\n1. ‰∏çË£ΩÈÄ†\n2. ‰∏çËºï‰ø°\n3. ‰∏çËΩâÂÇ≥\n‚òÖ Ë¶ÅÊü•Ë≠â\n‰ªª‰ΩïË™™„ÄåÂúãÂÆ∂Êà∞Êïó„ÄçÊàñ„ÄåÊäïÈôç„ÄçÁöÑÊ∂àÊÅØÔºåÈÄöÂ∏∏ÈÉΩÊòØÂÅáË®äÊÅØÔºÅ" 
                },
                { 
                    id: 302, type: "number", q: "ÁÇ∫‰∫ÜË≥áÂÆâÈò≤Ë≠∑ÔºåÊàëÂÄëË¶ÅÈÅµÂÆà„ÄåÂõõ‰∏çÂπæË¶Å„ÄçÂéüÂâáÔºü", a: "6", unit: "Ë¶Å", 
                    context: "„ÄêË≥áÂÆâÈò≤Ë≠∑Ôºö4‰∏ç6Ë¶Å„Äë\n‚óè4‰∏çÔºö‰∏çÈªû‰∏çÊòéÈÄ£Áµê„ÄÅ‰∏ç‰∫ÇÊéÉQR„ÄÅ‰∏çËºâÂèØÁñëApp„ÄÅ‰∏çÈÄ£ÂèØÁñëWiFi„ÄÇ\n‚óè6Ë¶ÅÔºöÂØÜÁ¢ºË¶ÅÊõ¥Êñ∞„ÄÅË≥áÊñôË¶ÅÂÇô‰ªΩ„ÄÅ‰ªãÈù¢Ë¶ÅÈóúÈñâ„ÄÅÂÇ≥Ëº∏Ë¶ÅÂä†ÂØÜ„ÄÅÂà™Èô§Ë¶ÅÂæπÂ∫ï„ÄÅË®äÊÅØË¶ÅÊü•Ë≠â„ÄÇ" 
                },
                { 
                    id: 303, type: "number", q: "ÈÅ≠ÈÅáÁÅ´ÁÅΩÊàñÈúÄË¶ÅÁ∑äÊÄ•ÊïëË≠∑ÊôÇÔºåË´ãÊí•ÊâìÂì™ÊîØÈõªË©±Ôºü", a: "119", unit: "Ëôü", 
                    context: "„ÄêÁ∑äÊÄ•Â∞àÁ∑ö„Äë\nüî• ÁÅ´ÁÅΩ„ÄÅÊïëË≠∑ËªäÔºö119\nüëÆ Â†±Ë≠¶Ôºö110\nüåä Êµ∑Â∑°ÊïëÈõ£Ôºö118\nüìû ËÅΩË™ûÈöúÁ∞°Ë®äÂ†±Ê°àÔºöÁ∞°Ë®äÂÇ≥Ëá≥ 119" 
                },
                { 
                    id: 304, type: "number", q: "Â¶ÇÊûúÊÑüÂà∞ÂøÉÊÉÖÁÑ¶ÊÖÆ„ÄÅÂ£ìÂäõÂæàÂ§ßÔºåÂèØ‰ª•Êí•ÊâìÂÆâÂøÉÂ∞àÁ∑öÔºü", a: "1925", unit: "Ëôü", 
                    context: "„ÄêÂøÉÁêÜÊîØÊåÅ„Äë\nÈù¢Â∞çÁÅΩÂÆ≥ÊÑüÂà∞ÂÆ≥ÊÄïÊòØÊ≠£Â∏∏ÁöÑ„ÄÇ\nÂ¶ÇÊûúË¶∫ÂæóÁÑ¶ÊÖÆÔºåÂèØ‰ª•Êí•Êâì„Äå1925 (‰æùËàäÊÑõÊàë)„ÄçÂÆâÂøÉÂ∞àÁ∑öÔºåÂ∞ãÊ±ÇÂ∞àÊ•≠ÂçîÂä©„ÄÇ" 
                },
                { 
                    id: 305, type: "number", q: "Èï∑ÁÖßÊúçÂãôÂ∞àÁ∑öÊòØÂì™‰∏ÄËôüÔºü", a: "1966", unit: "Ëôü", 
                    context: "„ÄêÂÖ∂‰ªñÈáçË¶ÅÂ∞àÁ∑ö„Äë\n‚óèÈï∑ÁÖßÊúçÂãôÔºö1966\n‚óèÂêÑÁ∏£Â∏Ç‰æøÊ∞ëÊúçÂãôÔºö1999\n‚óèÂèçË©êÈ®ôÂ∞àÁ∑öÔºö165" 
                }
            ]
        };

        const CATEGORIES = Object.keys(DATA);

        // --- Audio System ---
        const playTone = (freq, type, duration) => {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (!AudioContext) return;
            const ctx = new AudioContext();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            
            osc.type = type;
            osc.frequency.setValueAtTime(freq, ctx.currentTime);
            
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
            
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.start();
            osc.stop(ctx.currentTime + duration);
        };

        const playDingDong = () => {
            // C5 -> G5 (Happy sound)
            playTone(523.25, 'sine', 0.5); 
            setTimeout(() => playTone(783.99, 'sine', 0.6), 200);
        };

        const speak = (text, isMuted) => {
            if (isMuted || !window.speechSynthesis) return;
            window.speechSynthesis.cancel(); // Stop previous
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-TW';
            utterance.rate = 1.1; // Slightly faster for kids
            utterance.pitch = 1.3; // Higher pitch for "cute" effect
            window.speechSynthesis.speak(utterance);
        };

        // --- Components ---

        const Keypad = ({ onInput, onClear, onEnter, disabled }) => {
            const keys = ["1", "2", "3", "4", "5", "6", "7", "8", "9",".", "C", "0", "OK"];
            
            return (
                <div className="grid grid-cols-3 gap-3 p-4 bg-white/50 rounded-t-[40px] border-t-4 border-[var(--chiikawa-pink)]">
                    {keys.map(k => {
                        let bgColor = "var(--chiikawa-blue)";
                        if (k === "C") bgColor = "var(--chiikawa-red)";
                        if (k === "OK") bgColor = "var(--chiikawa-green)";

                        return (
                            <button
                                key={k}
                                disabled={disabled}
                                onClick={() => {
                                    if (k === "C") onClear();
                                    else if (k === "OK") onEnter();
                                    else onInput(k);
                                }}
                                className="btn-base keypad-btn text-2xl shadow-md"
                                style={{ backgroundColor: bgColor }}
                            >
                                {k === "OK" ? "‚ú®" : k}
                            </button>
                        );
                    })}
                </div>
            );
        };

        const App = () => {
            const [curCatIdx, setCurCatIdx] = useState(0);
            const [curQIdx, setCurQIdx] = useState(0);
            const [mode, setMode] = useState('recite'); // 'recite' | 'quiz'
            const [input, setInput] = useState("");
            const [isMuted, setIsMuted] = useState(false);
            const [feedback, setFeedback] = useState('idle'); // 'idle', 'correct', 'wrong'
            const [praise, setPraise] = useState("");
            const [targetVoice, setTargetVoice] = useState(null);
            useEffect(() => {
                const loadVoices = () => {
                    const voices = window.speechSynthesis.getVoices();
                    // ÂÑ™ÂÖàÈ†ÜÂ∫èÔºöiOS Áæé‰Ω≥ > Google ‰∏≠Êñá > ‰ªª‰ΩïÂè∞ÁÅ£‰∏≠Êñá > ‰ªª‰Ωï‰∏≠Êñá
                    const bestVoice = 
                        voices.find(v => v.name.includes("Mei-Jia")) || 
                        voices.find(v => v.name.includes("Google") && v.lang.includes("zh-TW")) ||
                        voices.find(v => v.lang === "zh-TW") ||
                        voices.find(v => v.lang.includes("zh"));

                    if (bestVoice) {
                        setTargetVoice(bestVoice); // ÊääÊâæÂà∞ÁöÑÂ•ΩËÅ≤Èü≥Â≠òËµ∑‰æÜ
                    }
                };
                
                window.speechSynthesis.onvoiceschanged = loadVoices;
                loadVoices();
            }, []);
            const speak = (text, checkMute) => {
        if (checkMute || !window.speechSynthesis) return;
        
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        
        if (targetVoice) {
            utterance.voice = targetVoice;
        }
        
        utterance.lang = 'zh-TW';
        utterance.pitch = 1.1; 
        utterance.rate = 0.95; 
        
        window.speechSynthesis.speak(utterance);
    };

            const currentQuestions = DATA[CATEGORIES[curCatIdx]];
            const currentQ = currentQuestions[curQIdx];

            const praises = ["‰Ω†ÁúüÊ£íÔºÅ", "Â§™Âº∑‰∫ÜÔºÅ", "‰∏ÄÁôæÂàÜÔºÅ", "Â•ΩÂé≤ÂÆ≥ÔºÅ", "Â§©ÊâçÔºÅ"];

            // Reset when category changes
            useEffect(() => {
                setCurQIdx(0);
                setInput("");
                setFeedback('idle');
            }, [curCatIdx]);

            // Reset when mode changes
            useEffect(() => {
                setInput("");
                setFeedback('idle');
                // Read question when switching to quiz
                if(mode === 'quiz') {
                    setTimeout(() => speak(currentQ.q, isMuted), 500);
                }
            }, [mode, curQIdx]);

            const handleInput = (num) => {
                if (feedback !== 'idle') return;
                if (input.length < 5) {
                    setInput(prev => prev + num);
                    speak(num, isMuted);
                }
            };

            const handleClear = () => {
                setInput("");
                speak("Ê∏ÖÈô§", isMuted);
            };

            const handleNextQuestion = () => {
                if (curQIdx < currentQuestions.length - 1) {
                    setCurQIdx(prev => prev + 1);
                } else {
                    // Loop back or stay
                    setCurQIdx(0); 
                    speak("ÊÅ≠ÂñúÂÆåÊàêÈÄôÂÄãÂñÆÂÖÉÔºÅ", isMuted);
                }
                setFeedback('idle');
                setInput("");
            };

            const handlePrevQuestion = () => {
                if (curQIdx > 0) setCurQIdx(prev => prev - 1);
            };

            const handleCheck = () => {
                if (feedback !== 'idle' || input === "") return;

                if (input === currentQ.a) {
                    // CORRECT
                    setFeedback('correct');
                    if (!isMuted) playDingDong();
                    
                    setTimeout(() => speak("Á≠îÂ∞ç‰∫ÜÔºÅ", isMuted), 600);
                    
                    const randomPraise = praises[Math.floor(Math.random() * praises.length)];
                    setPraise(randomPraise);
                    
                    setTimeout(() => speak(randomPraise, isMuted), 1400);

                    // Auto Next
                    setTimeout(() => {
                        handleNextQuestion();
                    }, 3500);

                } else {
                    // WRONG
                    setFeedback('wrong');
                    speak("Á≠îÈåØÂõâÔºåÂÜçË©¶‰∏ÄÊ¨°", isMuted);
                    setTimeout(() => {
                        setInput("");
                        setFeedback('idle');
                    }, 1500);
                }
            };

            return (
                <div className="flex flex-col h-full bg-white/30 backdrop-blur-sm">
                    
                    {/* Header */}
                    <div className="p-4 flex justify-between items-center bg-white/80 shadow-sm border-b-4 border-[var(--chiikawa-pink)] rounded-b-[30px] z-10">
                        <h1 className="text-xl font-bold text-[var(--chiikawa-brown)] flex items-center gap-2">
                            <span className="text-2xl">üêπ</span> ÂÆâÂÖ®Â∞èÈÅî‰∫∫
                        </h1>
                        <button 
                            onClick={() => setIsMuted(!isMuted)}
                            className="text-2xl w-10 h-10 bg-[var(--chiikawa-yellow)] rounded-full flex items-center justify-center border-2 border-[var(--chiikawa-brown)]"
                        >
                            {isMuted ? "üîï" : "üîî"}
                        </button>
                    </div>

                    {/* Category Selector */}
                    <div className="px-6 py-2">
                        <select 
                            value={curCatIdx}
                            onChange={(e) => setCurCatIdx(Number(e.target.value))}
                            className="w-full p-3 rounded-2xl border-2 border-[var(--chiikawa-blue)] bg-white text-[var(--chiikawa-brown)] font-bold text-lg outline-none text-center appearance-none"
                            style={{ backgroundImage: 'none' }} 
                        >
                            {CATEGORIES.map((cat, idx) => (
                                <option key={cat} value={idx}>{cat}</option>
                            ))}
                        </select>
                    </div>

                    {/* Mode Tabs */}
                    <div className="flex px-6 gap-2 mb-2">
                        <button 
                            onClick={() => setMode('recite')}
                            className={`flex-1 py-2 rounded-t-2xl font-bold ${mode === 'recite' ? 'tab-active' : 'tab-inactive'}`}
                        >
                            üìñ Â≠∏Áøí
                        </button>
                        <button 
                            onClick={() => setMode('quiz')}
                            className={`flex-1 py-2 rounded-t-2xl font-bold ${mode === 'quiz' ? 'tab-active' : 'tab-inactive'}`}
                        >
                            ‚ú® Ê∏¨È©ó
                        </button>
                    </div>

                    {/* Main Display Area (The Card) */}
                    <div className="flex-1 px-4 pb-2 flex flex-col min-h-0">
                        <div className={`chiikawa-card flex-1 p-6 flex flex-col items-center justify-center relative overflow-hidden transition-all duration-300 ${feedback === 'correct' ? 'scale-105 border-[var(--chiikawa-green)]' : ''} ${feedback === 'wrong' ? 'shake border-[var(--chiikawa-red)]' : ''}`}>
                            
                            {/* Question Number Badge */}
                            <div className="absolute top-4 left-4 bg-[var(--chiikawa-blue)] text-white px-3 py-1 rounded-full text-sm font-bold">
                                Q{curQIdx + 1}/{currentQuestions.length}
                            </div>

                            {/* Content */}
                            <div className="w-full text-center z-10">
                                {mode === 'recite' ? (
                                    <>
                                        <div className="text-xl font-bold mb-4">{currentQ.q}</div>
                                        <div className="text-4xl font-black text-[var(--chiikawa-pink)] mb-2">
                                            {currentQ.displayA || currentQ.a}
                                            <span className="text-2xl text-[var(--chiikawa-brown)] ml-1">{currentQ.unit}</span>
                                        </div>
                                        <div className="mt-4 p-3 bg-[var(--chiikawa-yellow)]/30 rounded-xl text-md leading-relaxed">
                                            {currentQ.context}
                                        </div>
                                        
                                        {/* Navigation for Recite Mode */}
                                        <div className="flex justify-between mt-6 w-full px-4">
                                            <button onClick={handlePrevQuestion} disabled={curQIdx===0} className="w-12 h-12 bg-[var(--chiikawa-blue)] rounded-full text-white text-2xl disabled:opacity-30">‚Üê</button>
                                            <button onClick={() => speak(currentQ.context, isMuted)} className="w-12 h-12 bg-[var(--chiikawa-pink)] rounded-full text-white text-xl">üîä</button>
                                            <button onClick={handleNextQuestion} className="w-12 h-12 bg-[var(--chiikawa-blue)] rounded-full text-white text-2xl">‚Üí</button>
                                        </div>
                                    </>
                                ) : (
                                    <>
                                        <div className="text-xl font-bold mb-6">{currentQ.q}</div>
                                        {/* Answer Box */}
                                        <div className="bg-[var(--chiikawa-brown)] text-[var(--chiikawa-yellow)] p-4 rounded-2xl text-4xl font-mono min-h-[80px] flex items-center justify-center border-4 border-gray-300 shadow-inner w-full max-w-[200px] mx-auto mb-2">
                                            {input || "?"}
                                        </div>
                                        <div className="text-sm text-gray-400 mb-4 h-5">{currentQ.inputHint}</div>

                                        {/* Feedback Overlay Text */}
                                        {feedback === 'correct' && (
                                            <div className="absolute inset-0 flex items-center justify-center bg-white/80 z-20 flex-col">
                                                <div className="text-6xl mb-2">üéâ</div>
                                                <div className="text-3xl font-black text-[var(--chiikawa-green)]">{praise}</div>
                                            </div>
                                        )}
                                        {feedback === 'wrong' && (
                                            <div className="absolute inset-0 flex items-center justify-center bg-white/80 z-20">
                                                <div className="text-3xl font-black text-[var(--chiikawa-red)]">ÂÜçË©¶Ë©¶ÁúãÔºÅ</div>
                                            </div>
                                        )}
                                    </>
                                )}
                            </div>

                            {/* Decorative Background Elements */}
                            <div className="absolute -bottom-10 -right-10 w-32 h-32 bg-[var(--chiikawa-yellow)] rounded-full opacity-20"></div>
                            <div className="absolute top-10 -left-10 w-20 h-20 bg-[var(--chiikawa-pink)] rounded-full opacity-20"></div>
                        </div>
                    </div>

                    {/* Keypad (Only visible in Quiz Mode) */}
                    {mode === 'quiz' && (
                        <div className="flex-none">
                            <Keypad 
                                onInput={handleInput} 
                                onClear={handleClear} 
                                onEnter={handleCheck}
                                disabled={feedback !== 'idle'}
                            />
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    
    <style>
        /* CSS Animation for Wrong Answer */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .shake {
            animation: shake 0.5s;
        }
    </style>
</body>
</html>
